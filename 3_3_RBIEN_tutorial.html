<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Brian Maitner" />


<title>RBIEN Tutorial</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="cm_yeti_bootswatch.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecology, Statistics, and Data Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Head2_Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Content
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Head1_CourseContent.html">About Course Content</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">1.0 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">1.1 First Steps</a>
    </li>
    <li>
      <a href="02_DataWrangling.html">1.2 Data Wrangling</a>
    </li>
    <li>
      <a href="03_Plotting.html">1.3 Plotting</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analyses</li>
    <li>
      <a href="04_Spatial.html">2.1 Spatial Data</a>
    </li>
    <li>
      <a href="05_Raster.html">2.2 Spatial Raster Data</a>
    </li>
    <li>
      <a href="06_RasterTwo.html">2.3 More Raster Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 3: Cleaning and Integrating Biodiversity Data</li>
    <li>
      <a href="3_1_Ecoinf_Schedule.html">3.1 Workshop Schedule</a>
    </li>
    <li>
      <a href="Under_Construction.html">3.2 Taxonomic Name Resolution</a>
    </li>
    <li>
      <a href="3_3_RBIEN_tutorial.html">3.3 Accessing Plant Biodiversity Data</a>
    </li>
    <li>
      <a href="Under_Construction.html">3.4 A streamlined range modeling workflow: Wallace</a>
    </li>
    <li>
      <a href="3_5_Minxent.html">3.5 Integrating biogeographic data </a>
    </li>
    <li>
      <a href="3_2_Networks.html">3.6 Network Associations</a>
    </li>
    <li>
      <a href="Under_Construction.html">3.7 Teaching Econformatics</a>
    </li>
  </ul>
</li>
<li>
  <a href="Head3_Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmerow/RDataScience/tree/gh-pages">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">RBIEN Tutorial</h1>
<h4 class="author"><em>Brian Maitner</em></h4>

</div>


<p><a href="3_3_RBIEN_tutorial.R"><i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here</a>. Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.</p>
<div id="setup" class="section level1">
<h1><span class="header-section-number">1</span> Setup</h1>
<pre class="r"><code>library(BRI)
library(ape) #Package for working with phylogenies in R
library(maps) #Useful for making quick maps of occurrences
library(sp) # A package for spatial data</code></pre>
</div>
<div id="an-overview-of-the-package" class="section level1">
<h1><span class="header-section-number">2</span> An overview of the package</h1>
<p>We try to make this package as easy and intuitive to use as possible, but it is still often easiest to start with our vignette. Particularly useful are the “Function Names” and “Function Directory” sections.</p>
<pre class="r"><code>vignette(&quot;BRI&quot;)</code></pre>
<p>The function names follow a consistent naming strategy, and mostly consist of 3 parts:</p>
<ol style="list-style-type: decimal">
<li>The prefix “BIEN_”</li>
<li>The type of data being accessed, e.g. “occurrence_”</li>
<li>How you’ll be querying the data. For example, the suffix “state” refers to functions that return data for a specified state.</li>
</ol>
<p>As a complete example, the function <code>BIEN_occurrence_species</code> returns occurrence records for a given species (or set of species).</p>
</div>
<div id="function-families" class="section level1">
<h1><span class="header-section-number">3</span> Function Families</h1>
<p>Currently we have 10 function families in RBIEN. These are sets of functions that access a given type of data.</p>
<ol style="list-style-type: decimal">
<li>occurrence records (BIEN_occurrence_…)</li>
<li>range maps (BIEN_ranges_…)</li>
<li>plot data (BIEN_plot_…)</li>
<li>trait data (BIEN_trait_…)</li>
<li>taxonomic information (BIEN_taxonomy_…)</li>
<li>phylogenies (BIEN_phylogeny_…)</li>
<li>stem data (BIEN_stem_…)</li>
<li>species lists (BIEN_list_…)</li>
<li>metadata (BIEN_metadata_…)</li>
<li>custom queries (BIEN_sql)</li>
</ol>
<p>We’ll walk through each of the function families and take a look at some the options available within each.</p>
</div>
<div id="occurrence-records" class="section level1">
<h1><span class="header-section-number">4</span> Occurrence records</h1>
<p>These functions begin with the prefix “BIEN_occurrence_” and allow you to query occurrences by either taxonomy or geography. Functions include:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_occurrence_country</code> Returns all occurrence records within a given country</p></li>
<li><p><code>BIEN_occurrence_state</code> Returns all occurrences records within a given state/province</p></li>
<li><p><code>BIEN_occurrence_county</code> Returns all occurrences records within a given state/province</p></li>
<li><p><code>BIEN_occurrence_family</code> Returns all occurrence records for a specified family</p></li>
<li><p><code>BIEN_occurrence_genus</code> Returns all occurrence records for a specified genus</p></li>
<li><p><code>BIEN_occurrence_species</code> Returns all occurrence records for a specified species</p></li>
<li><p><code>BIEN_occurrence_state</code> Returns all occurrences records within a given state/province</p></li>
</ol>
<p>Each of these functions has a number of different arguments that modify your query, either refining your search criteria or returning more data for each record. These arguments include:</p>
<ol style="list-style-type: decimal">
<li><p>cultivated If TRUE, records known to be cultivated will be returned.</p></li>
<li><p>only.new.world If TRUE, records returned are limited to those in North and South America, where greater data cleaing and validation has been done.</p></li>
</ol>
<ul>
<li>Note that the arguments cultivated and only.new.world may change the number of records returned.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>all.taxonomy If TRUE, the query will return additional taxonomic data, including the uncorrected taxonomic information for those records.</p></li>
<li><p>native.status If TRUE, additional information will be returned regarding whether a species is native in a given region.</p></li>
<li><p>observation.type If TRUE, the query will return whether each record is from either a plot or a specimen. This may be useful if a user believes one type of information may be more accurate.</p></li>
<li><p>political.boundaries If TRUE, the query will return information on which country, state, etc. that an occurrence is found within.</p></li>
<li><p>print.query If TRUE, the function will print the SQL query that it used. This is mostly useful for users looking to create their own custom queries (which should be done with caution).</p></li>
</ol>
<p><strong>Example 1: Occurrence records for a species</strong></p>
<p>Okay, enough reading. Let’s get some data.</p>
<p>Let’s say we’re interested in the species <em>Xanthium strumarium</em> and we’d like some occurrence data. We’ll use the function <code>BIEN_occurrence_species</code> to grab the occurrence data.</p>
<pre class="r"><code>Xanthium_strumarium &lt;- BIEN_occurrence_species(species = &quot;Xanthium strumarium&quot;)</code></pre>
<p>Take a moment and view the dataframe and take a look at the structure</p>
<pre class="r"><code>View(Xanthium_strumarium)
str(Xanthium_strumarium)</code></pre>
<p>The default data that is returned consists of the latitude, longitude and date collected, along with a set of attribution data. If we want more information on these occurrences, we just need to change the arguments:</p>
<pre class="r"><code>Xanthium_strumarium_full &lt;- BIEN_occurrence_species(species = &quot;Xanthium strumarium&quot;,cultivated = T,only.new.world = F,all.taxonomy = T,native.status = T,observation.type = T,political.boundaries = T)

str(Xanthium_strumarium_full)</code></pre>
<pre><code>## &#39;data.frame&#39;:    6356 obs. of  33 variables:
##  $ scrubbed_species_binomial   : chr  &quot;Xanthium strumarium&quot; &quot;Xanthium strumarium&quot; &quot;Xanthium strumarium&quot; &quot;Xanthium strumarium&quot; ...
##  $ verbatim_family             : chr  &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; ...
##  $ verbatim_scientific_name    : chr  &quot;Xanthium strumarium L.&quot; &quot;Xanthium chinense Mill.&quot; &quot;Xanthium strumarium L.&quot; &quot;Xanthium strumarium L.&quot; ...
##  $ family_matched              : chr  &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; ...
##  $ name_matched                : chr  &quot;Xanthium strumarium&quot; &quot;Xanthium chinense&quot; &quot;Xanthium strumarium&quot; &quot;Xanthium strumarium&quot; ...
##  $ name_matched_author         : chr  &quot;L.&quot; &quot;Mill.&quot; &quot;L.&quot; &quot;L.&quot; ...
##  $ higher_plant_group          : chr  &quot;flowering plants&quot; &quot;flowering plants&quot; &quot;flowering plants&quot; &quot;flowering plants&quot; ...
##  $ taxonomic_status            : chr  &quot;accepted&quot; &quot;accepted&quot; &quot;accepted&quot; &quot;accepted&quot; ...
##  $ scrubbed_family             : chr  &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; &quot;Asteraceae&quot; ...
##  $ scrubbed_author             : chr  &quot;L.&quot; &quot;L.&quot; &quot;L.&quot; &quot;L.&quot; ...
##  $ native_status               : chr  &quot;UNK&quot; &quot;N&quot; &quot;UNK&quot; &quot;UNK&quot; ...
##  $ native_status_reason        : chr  &quot;Status unknown, no checklists for region of observation&quot; &quot;Native to region, as per checklist&quot; &quot;Status unknown, no checklists for region of observation&quot; &quot;Status unknown, no checklists for region of observation&quot; ...
##  $ native_status_sources       : chr  &quot;&quot; &quot;usda, vascan, tropicos&quot; &quot;&quot; &quot;&quot; ...
##  $ isintroduced                : chr  NA &quot;0&quot; NA NA ...
##  $ native_status_country       : chr  &quot;&quot; &quot;N&quot; &quot;&quot; &quot;&quot; ...
##  $ native_status_state_province: chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ native_status_county_parish : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ country                     : chr  &quot;Argentina&quot; &quot;Canada&quot; &quot;Mexico&quot; &quot;Mexico&quot; ...
##  $ state_province              : chr  &quot;Cordoba&quot; &quot;Québec&quot; &quot;Sonora&quot; &quot;Sonora&quot; ...
##  $ county                      : chr  NA NA &quot;Guaymas Municipio&quot; &quot;General Plutarco Elías Calles Municipio&quot; ...
##  $ locality                    : chr  &quot;N of Abrojo&quot; &quot;St-Nicolas (Lévis).; habitat: Bord de chemin, haut de grève.&quot; &quot;Roadside at south side of Guaymas airport; habitat: Disturbed habitat; desertscrub&quot; &quot;Pinacate Region, Rancho los Vidrios&quot; ...
##  $ latitude                    : num  NA NA NA NA NA ...
##  $ longitude                   : num  NA NA NA NA NA ...
##  $ date_collected              : Date, format: NA &quot;1963-09-05&quot; ...
##  $ datasource                  : chr  &quot;TRT&quot; &quot;QFA&quot; &quot;ARIZ&quot; &quot;ARIZ&quot; ...
##  $ dataset                     : chr  &quot;Royal Ontario Museum&quot; &quot;Université Laval&quot; NA NA ...
##  $ dataowner                   : chr  &quot;Royal Ontario Museum&quot; &quot;Université Laval&quot; NA NA ...
##  $ custodial_institution_codes : chr  &quot;Royal Ontario Museum&quot; &quot;Université Laval&quot; NA NA ...
##  $ collection_code             : chr  &quot;TRT&quot; &quot;QFA&quot; NA NA ...
##  $ is_cultivated               : int  NA NA NA NA 0 NA NA 0 NA NA ...
##  $ is_cultivated_in_region     : chr  &quot;0&quot; &quot;0&quot; &quot;0&quot; &quot;0&quot; ...
##  $ is_new_world                : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ observation_type            : chr  &quot;specimen&quot; &quot;specimen&quot; &quot;specimen&quot; &quot;specimen&quot; ...</code></pre>
<p>We now have considerably more information, but the query took longer to run.</p>
<p>Let’s take a quick look at where those occurrences are.</p>
<pre class="r"><code># Make a quick map to plot our points on

map(&#39;world&#39;,fill=T , col= &quot;grey&quot;, bg=&quot;light blue&quot;) 

#Plot the points from the full query in red

points(cbind(Xanthium_strumarium_full$longitude,Xanthium_strumarium_full$latitude),col=&quot;red&quot;,pch=20,cex=1) 

# Plot the points from the default query in blue

points(cbind(Xanthium_strumarium$longitude,Xanthium_strumarium$latitude),col=&quot;blue&quot;,pch=20,cex=1) </code></pre>
<p><img src="3_3_RBIEN_tutorial_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p>From the map, we can see that the points from the default query (in blue) all fall within the New World. The points from the full query (red + blue) additionally include occurrences from the Old World. The points in the Old World have not gone through the same data validation procedures as those in the New World, but may still be useful.</p>
<p><strong>Example 2: Occurrence records for a country</strong></p>
<p>Since we may be interested in a particular geographic area, rather than a particular set of species, there are also options to easily extract data by political region as well.</p>
<p>We’ll choose a relatively small region, the Bahamas, for our demonstration.</p>
<pre class="r"><code>Bahamas &lt;- BIEN_occurrence_country(country =  &quot;Bahamas&quot;)

#Let&#39;s see how many species we have
length(unique(Bahamas$scrubbed_species_binomial))</code></pre>
<pre><code>## [1] 999</code></pre>
<pre class="r"><code>#Nearly 1000 species, not bad.

#Now, let&#39;s take a look at where those occurrences are:
map(regions = &quot;Bahamas&quot; ,fill=T , col= &quot;grey&quot;, bg=&quot;light blue&quot;)

points(cbind(Bahamas$longitude,Bahamas$latitude),col=&quot;blue&quot;,pch=20,cex=1)</code></pre>
<p><img src="3_3_RBIEN_tutorial_files/figure-html/unnamed-chunk-8-1.png" /><!-- --></p>
<pre class="r"><code>#Looks like some islands are considerably better sampled than others.</code></pre>
</div>
<div id="range-maps" class="section level1">
<h1><span class="header-section-number">5</span> Range maps</h1>
<p>These functions begin with the prefix “BIEN_ranges_” and return (unsurprisingly) species ranges. Most of these functions work by saving the downloaded ranges to a specified directory in shapefile format, rather than by loading them into the R environment.</p>
<p>Functions include:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_ranges_species</code> Downloads range maps for given species and save them to a specified directory.</p></li>
<li><p><code>BIEN_ranges_genus</code> Saves range maps for all species within a genus to a specified directory.</p></li>
<li><p><code>BIEN_ranges_load_species</code> This function returns the ranges for a set of species as a SpatialPolygonsDataFrame object.</p></li>
</ol>
<p>The range functions have different arguments than we have seen so far, including:</p>
<ol style="list-style-type: decimal">
<li><p>directory This is where the function will be saving the shapefiles you download</p></li>
<li><p>matched If TRUE, the function will return a dataframe listing which species ranges were downloaded and which weren’t.</p></li>
<li><p>match_names_only If TRUE, the function will check whether a map is available for each species without actually downloading it</p></li>
<li><p>include.gid If TRUE, the function will append a unique gid number to each range map’s filename. This argument is designed to allow forward compatibility when BIEN contains multiple range maps for each species.</p></li>
</ol>
<!-- **Example 3: Range maps and occurrence points** -->
<!-- If we have a species we're interested in, and would like to load the range map into the environment,  we can use the function `BIEN_ranges_load_species`.  Let's try this for *Xanthium strumarium*. -->
<!-- ```{r} -->
<!-- Xanthium_strumarium_range <- BIEN_ranges_load_species(species = "Xanthium strumarium") -->
<!-- ``` -->
<!-- The range map is now in our global environment as a Spatial polygons dataframe.  Let's plot the map and see what it looks like. -->
<!-- ```{r} -->
<!-- #First, let's add a base map so that our range has some context: -->
<!-- map('world',fill=T , col= "grey", bg="light blue",xlim = c(-180,-20),ylim = c(-60,80)) -->
<!-- #Now, we can add the range map: -->
<!-- plot(Xanthium_strumarium_range,col="green",add=T) -->
<!-- ``` -->
<!-- Now, let's add those occurrence points from earlier to this map: -->
<!-- ```{r} -->
<!-- map('world',fill=T , col= "grey", bg="light blue",xlim = c(-180,-20),ylim = c(-60,80)) -->
<!-- plot(Xanthium_strumarium_range,col="green",add=T) -->
<!-- points(cbind(Xanthium_strumarium$longitude,Xanthium_strumarium$latitude),col="blue",pch=20,cex=1) -->
<!-- ``` -->
<!-- # Plot data -->
<!-- These functions begin with the prefix "BIEN_plot_" and return ecological plot data.  Functions include: -->
<!-- 1. `BIEN_plot_list_sampling_protocol` Returns the different plot sampling protocols found in the BIEN database. -->
<!-- 2. `BIEN_plot_list_datasource` Returns the different datasources that are available in the BIEN database. -->
<!-- * These first two functions are useful for identifying plots with comparable sampling methods. -->
<!-- 3. `BIEN_plot_sampling_protocol` Downloads data for a specified sampling protocol -->
<!-- 4. `BIEN_plot_datasource` Downloads data for a specific datasource -->
<!-- * These next two function are then useful for downloading datasets with consistent methodology. -->
<!-- 5. `BIEN_plot_country` -->
<!-- 6. `BIEN_plot_state` -->
<!-- 7. `BIEN_plot_dataset` Downloads data for a given dataset (which is nested within a datasource) -->
<!-- 8. `BIEN_plot_name` Downloads data for a specific plot name (these are nested within a given dataset) -->
<!-- Again we have some of the same arguments available for these queries that we saw for the occurrence functions.  We also have the new argument *all.metadata*, which causes the functions to return more metadata for each plot. -->
<p><strong>Example 4: Plot data by plot name</strong></p>
<p>Let’s take a look at the data for an individual plot.</p>
<pre class="r"><code>LUQUILLO &lt;- BIEN_plot_name(plot.name = &quot;LUQUILLO&quot;)
View(LUQUILLO)</code></pre>
<p>We can see that this is a 0.1 hectare transect where stems &gt;= 2.5 cm diameter at breast height were included. If we’d like more detail, we can use additional arguments:</p>
<pre class="r"><code>LUQUILLO_full &lt;- BIEN_plot_name(plot.name = &quot;LUQUILLO&quot;,cultivated = T,all.taxonomy = T,native.status = T,political.boundaries = T,all.metadata = T)</code></pre>
<pre class="r"><code>View(LUQUILLO_full)</code></pre>
<p>The dataframe LUQUILLO_full contains more useful information, including metadata on which taxa were included, which growth forms were included and information on whether species are known to be native or introduced.</p>
</div>
<div id="trait-data" class="section level1">
<h1><span class="header-section-number">6</span> Trait data</h1>
<p>These functions begin with the prefix “BIEN_trait_” and access the BIEN trait database. Note that the spelling of the trait names must be precise, so we recommend using the function <code>BIEN_trait_list</code> first.</p>
<p>Functions include:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_trait_list</code> Start with this. It returns a dataframe of the traits available.</p></li>
<li><p><code>BIEN_trait_family</code> Returns a dataframe of all trait data for a given family (or families).</p></li>
<li><p><code>BIEN_trait_genus</code></p></li>
<li><p><code>BIEN_trait_species</code></p></li>
<li><p><code>BIEN_trait_trait</code> Downloads all records of a specified trait (or traits).</p></li>
<li><p><code>BIEN_trait_mean</code> Estimates species mean trait values using genus or family level means where species-level data is absent.</p></li>
<li><p><code>BIEN_trait_traitbyfamily</code> Downloads data for a given family (or families) and trait(s).</p></li>
<li><p><code>BIEN_trait_traitbygenus</code></p></li>
<li><p><code>BIEN_trait_traitbyspecies</code></p></li>
</ol>
<p><strong>Example 5: Accessing trait data</strong></p>
<p>If you’re interested in accessing all traits for a taxon, say the genus <em>Salix</em>, just go ahead and use the corresponding function:</p>
<pre class="r"><code>Salix_traits&lt;-BIEN_trait_genus(genus = &quot;Salix&quot;)</code></pre>
<p>If instead we’re interested in a particular trait, the first step is to check if that trait is present and verify the spelling using the function <code>BIEN_trait_list</code>.</p>
<pre class="r"><code>BIEN_trait_list()</code></pre>
<pre><code>##                           trait_name
## 1  Area-based photosynthesis (Aarea)
## 2                     Flowering date
## 3                    Flowering month
## 4                             Height
## 5                          Leaf area
## 6                         Leaf Cmass
## 7                      Leaf dry mass
## 8     Leaf dry matter content (LDMC)
## 9                Leaf lifespan (LLS)
## 10                        Leaf Narea
## 11                        Leaf Nmass
## 12                        Leaf Parea
## 13                        Leaf Pmass
## 14 Mass-based photosynthesis (Amass)
## 15                         seed mass
## 16          Specific leaf area (SLA)
## 17         Stomatal conductance (Gs)
## 18                      wood density
## 19                              &lt;NA&gt;</code></pre>
<p>If we’re interested in Specific Leaf Area, we see that this is called “Specific leaf area (SLA)” in the database. Now that we know the proper spelling, we can use the function <code>BIEN_trait_trait</code> to download all observations of that trait.</p>
<pre class="r"><code>SLA &lt;- BIEN_trait_trait(trait = &quot;Specific leaf area (SLA)&quot;)</code></pre>
<p>Note that the units have been standardized and that there is a full set of attribution data for each trait.</p>
</div>
<div id="taxonomy-data" class="section level1">
<h1><span class="header-section-number">7</span> Taxonomy Data</h1>
<p>While there are existing packages that query taxonomic data (e.g. those included in the taxize package), the RBIEN taxonomy functions access the taxonomic information that underlies the BIEN database, ensuring consistency.</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_taxonomy_family</code> Downloads all taxonomic information for a given family.</p></li>
<li><p><code>BIEN_taxonomy_genus</code></p></li>
<li><p><code>BIEN_taxonomy_species</code></p></li>
</ol>
<p><strong>Example 6: Taxonomic data </strong></p>
<p>Let’s say we’re interested in the genus <em>Asclepias</em>, and we’d like to get an idea of how many species there are in this genus and what higher taxa it falls within.</p>
<pre class="r"><code>Asclepias_taxonomy&lt;-BIEN_taxonomy_genus(genus = &quot;Asclepias&quot;)

View(Asclepias_taxonomy)

#We see that the genus Asclepias falls within the family Apocynaceae and the order Gentianales.

#You&#39;ll also notice that a given species may appear more than once (due to multiple circumscriptions, some of which may be illegitimate).

#If we&#39;d just like to know all the speciess that aren&#39;t illegitimate:
Asclepias_species&lt;-unique(Asclepias_taxonomy$scrubbed_species_binomial[Asclepias_taxonomy$scrubbed_taxonomic_status %in% c(&quot;accepted&quot;,  &quot;no opinion&quot;)])</code></pre>
</div>
<div id="phylogenies" class="section level1">
<h1><span class="header-section-number">8</span> Phylogenies</h1>
<p>The BIEN database currently contains 101 phylogenies for new world plants. This includes 100 replicated phylogenies that include nearly all New World plant species (“complete phylogenies”) and 1 phylogeny containing only those New World plant species for which molecular data was available (“conservative phylogeny”). Currently, there are only 2 functions available:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_phylogeny_complete</code> This function will return a specified number of the replicated “complete” phylogenies. Note that each phylogeny is several Mb in size, so downloading many may take a while on slow connections.</p></li>
<li><p><code>BIEN_phylogeny_conservative</code> This function returns the conservative phylogeny.</p></li>
</ol>
<p>Arguments: The function <code>BIEN_phylogeny_complete</code> has a few arguments that are worth explaining:</p>
<p>n_phylogenies This is the number of replicated phylogenies that you want to download (between 1 and 100)</p>
<p>seed This function sets the seed for the random number generator before randomly drawing the phylogenies to be downloaded. This is useful for replicating analyses.</p>
<p>replicates This function allows you to specify WHICH of the 100 phylogenies to download, rather than having them selected randomly.</p>
<p><strong>Example 7: Phylogenies </strong></p>
<p>Let’s say we want to download the conservative phylogeny.</p>
<pre class="r"><code>phylo &lt;- BIEN_phylogeny_conservative()

#Let&#39;s make sure it looks alright

plot.phylo(x = phylo, show.tip.label =  FALSE)</code></pre>
<p><img src="3_3_RBIEN_tutorial_files/figure-html/unnamed-chunk-16-1.png" /><!-- --></p>
<pre class="r"><code>#If we just want to see which species are included

phylo_species &lt;- phylo$tip.label</code></pre>
</div>
<div id="stem-data" class="section level1">
<h1><span class="header-section-number">9</span> Stem Data</h1>
<p>The BIEN datbase contains stem data associated with many of the plots. This is typically either diameter at breast height or diameter at ground height. At present, there is only one stem function (although expect more in the future):</p>
<ol style="list-style-type: decimal">
<li><code>BIEN_stem_species</code> This function downloads all of the stem data for a given species (or set of species)</li>
</ol>
<p>Arguments:</p>
<p>The arguments for this function are the same that we have seen in the occurrence and plot functions.</p>
<p><strong>Example 8: Stem data </strong></p>
</div>
<div id="species-lists" class="section level1">
<h1><span class="header-section-number">10</span> Species lists</h1>
<p>These functions begin with the prefix “BIEN_list_” and allow you to quickly get a list of all the species in a geographic unit. Functions include:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_list_country</code> Returns all species found within a country.</p></li>
<li><p><code>BIEN_list_state</code> Returns all species found within a given state/province</p></li>
<li><p><code>BIEN_list_county</code> Returns all species found within a given state/province</p></li>
</ol>
<p>Some of the same arguments we saw in the occurrence functions appear here as well, including “cultivate”, “only.new.world” and “print.query”.</p>
<p><strong>Example 9: Species list for a country</strong></p>
<p>Let’s return to our previous example. What if we just need a list of the species in the Bahamas, rather than the specific details of each occurrence record? We can instead use the function <code>BIEN_list_country</code> to download a list of species, which should be much faster than using <code>BIEN_occurrence_country</code> to get a species list.</p>
<pre class="r"><code>Bahamas_species_list&lt;-BIEN_list_country(country = &quot;Bahamas&quot;)

#Notice that this time, we have 998 species, whereas previously we saw that there were 999 unique species.  What happened?  The list functions ignore NA values for species names, but R does not.  R counted NA values as a unique species name, giving one extra unique value.</code></pre>
<p>If we wanted to retrieve the results for multiple countries at once, that is simple as well. We just need to supply a vector of countries.</p>
<pre class="r"><code>country_vector&lt;-c(&quot;Haiti&quot;,&quot;Dominican Republic&quot;)
Haiti_DR &lt;- BIEN_list_country(country = country_vector)</code></pre>
</div>
<div id="metadata" class="section level1">
<h1><span class="header-section-number">11</span> Metadata</h1>
<p>The BIEN metadata functions are still in development. Currently, there are only 2 functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>BIEN_metadata_database_version</code> Returns the current version number of the BIEN database and the release date.</p></li>
<li><p><code>BIEN_metadata_match_data</code> Rudimentary function to check for changed records between old and current queries.</p></li>
</ol>
<p><strong>Example 10: Metadata </strong></p>
<p>To check what the current version of the BIEN database is (which we recommend reporting when using BIEN data):</p>
<pre class="r"><code>BIEN_metadata_database_version()</code></pre>
<pre><code>##   db_version db_release_date
## 1      3.4.0      2016-11-22</code></pre>
</div>
<div id="custom-queries" class="section level1">
<h1><span class="header-section-number">12</span> Custom Queries</h1>
<p>We recommend avoiding custom queries where possible. If you have an idea for a new function/functionality, contacting the package maintainer or submitting a note on the Github site for the package may be a better idea. However, if you need to write your own SQL query, we recommend that you familiarize yourself with both postgresql and the BIEN database structure first. Most of our functions have the argument “print.query” which will display the SQL query that the function utilized. These queries can provide a starting point for custum queries (by adding or omitting parts of them). These queries can then be executed using the function <code>BIEN_sql</code>.</p>
<ol style="list-style-type: decimal">
<li><code>BIEN_sql</code> This function returns the results of a postgresql query. This function is typically used as an internal function, but can be used for writing custom queries.</li>
</ol>
<p>Arguments:</p>
<p>The argument “query” is the only one likely to be of use to users. The other arguments are included for primarily for developmental purposes.</p>
<p><strong>Example 11: Writing your own query </strong> Let’s return to our example from above where we downloaded the occurrence records for <em>Xanthium strumarium</em>. Let’s take a look at the query that underlies that:</p>
<pre class="r"><code>Xanthium_strumarium &lt;- BIEN_occurrence_species(species = &quot;Xanthium strumarium&quot;,print.query = T)</code></pre>
<pre><code>## [1] &quot;SELECT scrubbed_species_binomial, latitude, longitude,date_collected,datasource,dataset,dataowner,custodial_institution_codes,collection_code FROM view_full_occurrence_individual WHERE scrubbed_species_binomial in ( &#39;Xanthium strumarium&#39; ) AND (is_cultivated = 0 OR is_cultivated IS NULL) AND is_new_world = 1 AND higher_plant_group IS NOT NULL AND (is_geovalid = 1 OR is_geovalid IS NULL) ORDER BY scrubbed_species_binomial;&quot;</code></pre>
<p>We see that our query looks like this:</p>
<p>“SELECT scrubbed_species_binomial, latitude, longitude,date_collected,datasource,dataset,dataowner,custodial_institution_codes,collection_code FROM view_full_occurrence_individual WHERE scrubbed_species_binomial in ( ‘Xanthium strumarium’ ) AND (is_cultivated = 0 OR is_cultivated IS NULL) AND is_new_world = 1 AND higher_plant_group IS NOT NULL AND (is_geovalid = 1 OR is_geovalid IS NULL) ORDER BY scrubbed_species_binomial;”</p>
<p>Now, if we want to modify this to be more restrictive and only include occurrences that could be geovalidated and are not cultivated, that simply involves a few changes:</p>
<p>“SELECT scrubbed_species_binomial, latitude, longitude,date_collected,datasource,dataset,dataowner,custodial_institution_codes,collection_code FROM view_full_occurrence_individual WHERE scrubbed_species_binomial in ( ‘Xanthium strumarium’ ) AND (is_cultivated = 0 ) AND is_new_world = 1 AND higher_plant_group IS NOT NULL AND (is_geovalid = 1 ) ORDER BY scrubbed_species_binomial;”</p>
<p>We can now submit this new but of code using <code>BIEN_sql</code></p>
<pre class="r"><code>Xanthium_strumarium_modified &lt;- BIEN_sql(query = &quot;SELECT scrubbed_species_binomial, latitude, longitude,date_collected,datasource,dataset,dataowner,custodial_institution_codes,collection_code FROM view_full_occurrence_individual WHERE scrubbed_species_binomial in ( &#39;Xanthium strumarium&#39; ) AND (is_cultivated = 0 ) AND is_new_world = 1 AND higher_plant_group IS NOT NULL AND (is_geovalid = 1 ) ORDER BY scrubbed_species_binomial;&quot;)

#This query only returns a fraction of the records the default query does, but for some purposes we may only want the highest quality records.</code></pre>
<!-- # Combining Queries -->
<!-- **Example 12: Putting it all together ** -->
</div>


<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="https://cmerow.github.io"><img src="img/cory.png" alt="logo" width=40px></a>
  <!--
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  -->
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
